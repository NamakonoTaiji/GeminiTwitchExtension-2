# APIキーセキュリティ機能マニュアルテスト計画

このドキュメントでは、APIキーセキュリティ機能の実際の使用シナリオに基づくマニュアルテスト手順を説明します。

## テスト環境の準備

1. Chrome ブラウザで拡張機能をデバッグモードでロード
2. オプションページとバックグラウンドページを開いた状態で準備

## テストケース

### テストケース1: APIキーの設定と保存

**手順:**
1. オプションページを開く（拡張機能のアイコンを右クリック→「オプション」）
2. APIキー入力フィールドに有効なGemini APIキーを入力
3. 「保存」ボタンをクリック
4. ページをリロード

**期待される結果:**
1. 保存ボタンクリック時に成功メッセージが表示される
2. ページリロード後もAPIキーが入力フィールドに表示されている
3. バックグラウンドコンソールで「APIキーを安全に保存しました」などのログが確認できる

### テストケース2: APIキーの暗号化確認

**手順:**
1. Chrome DevToolsで、Application タブを開く
2. Storage → Local Storage を選択
3. `chrome-extension://[拡張機能ID]` を選択

**期待される結果:**
1. `encrypted_api_key` というキーが存在する
2. その値は暗号化された形式（`encryptedData`と`iv`を含むJSON）である
3. 元のAPIキーは平文で保存されていない

### テストケース3: 拡張機能再起動後のAPIキー保持

**手順:**
1. chrome://extensions/ ページを開く
2. 拡張機能の再読み込みボタンをクリック
3. オプションページを再度開く

**期待される結果:**
1. オプションページで、設定したAPIキーが表示されている
2. バックグラウンドページのコンソールでエラーが発生していない
3. 再起動後も拡張機能が正常に動作する

### テストケース4: 長いAPIキーの処理

**手順:**
1. オプションページを開く
2. 非常に長い文字列（100文字以上）をAPIキーとして入力
3. 保存して再読み込み

**期待される結果:**
1. エラーなく保存され、再読み込み後も表示される
2. 暗号化・復号化処理が正常に機能する

### テストケース5: 特殊文字を含むAPIキーの処理

**手順:**
1. オプションページを開く
2. 特殊文字（`!@#$%^&*()_+-=[]{}|;:'",.<>/?`）を含むAPIキーを入力
3. 保存して再読み込み

**期待される結果:**
1. エラーなく保存され、再読み込み後も同じ値が表示される
2. 暗号化・復号化処理が正常に機能する

### テストケース6: APIキーの変更

**手順:**
1. オプションページで既存のAPIキーを別の値に変更
2. 保存してページをリロード

**期待される結果:**
1. 新しいAPIキーが正常に保存される
2. バックグラウンドコンソールで「APIキーを安全に保存しました」などのログが確認できる
3. Local Storageの暗号化データが更新されている

### テストケース7: APIキーの削除

**手順:**
1. オプションページでAPIキー入力フィールドを空にする
2. 保存してページをリロード

**期待される結果:**
1. APIキーが削除されたことを示すメッセージが表示される
2. 再読み込み後、入力フィールドが空である
3. Local Storageから `encrypted_api_key` エントリが削除されている

### テストケース8: 移行機能のテスト

**手順:**
1. Chrome DevToolsで、Application タブを開く
2. Storage → Sync Storage を選択し、手動で `api_key` エントリを追加（値は任意のAPIキー）
3. 拡張機能を再読み込み
4. オプションページを開く

**期待される結果:**
1. 古いストレージ形式から新しい形式にAPIキーが移行される
2. オプションページに移行されたAPIキーが表示される
3. Sync Storageから古いAPIキーエントリが削除されている
4. Local Storageに暗号化された新しいエントリが追加されている

## テスト結果の記録

テスト結果は以下の形式で記録してください：

- テストケース番号
- 実行日時
- テスト環境（ブラウザバージョン、OS）
- 結果（成功/失敗）
- 問題が発生した場合の詳細
- スクリーンショットまたはログ（あれば）